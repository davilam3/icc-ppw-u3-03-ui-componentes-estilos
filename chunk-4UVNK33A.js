import{a as Ee,b as Ce,d as Pe,e as oe,f as ye,g as re,h as ke,j as we,k as De,l as Te}from"./chunk-WDNJL2XZ.js";import{b as ne,h as Fe,j as G}from"./chunk-3N3QZNMZ.js";import{E as Se,F as R,b as he,e as xe,h as H}from"./chunk-LK7MMN56.js";import{j as be}from"./chunk-3GREFYWT.js";import{$ as b,A as y,Ab as I,Ba as z,Bb as ge,D as ce,Db as w,Ea as s,Eb as j,Fb as ve,Jb as fe,K as O,Kb as _e,Ob as D,Q as V,Ra as k,V as u,_,a as Z,aa as B,ab as x,b as ee,ba as $,bb as F,cb as me,db as T,eb as N,fb as f,gb as a,hb as r,ib as C,jb as m,kb as d,la as h,lb as ie,mb as M,n as A,na as te,nb as de,o as v,oa as q,ob as g,qb as c,s as P,ub as pe,wb as U,xb as ue,yb as o,zb as S}from"./chunk-IHFSFQAP.js";var Ne={production:!1,apiUrl:"https://thesimpsonsapi.com/api"};var J=class i{http=u(he);API_URL=Ne.apiUrl;getCharacters(t=1){return this.http.get(`${this.API_URL}/characters?page=${t}`).pipe(P(e=>e),y(e=>(console.error("Error al obtener personajes",e),v({count:0,next:null,prev:null,pages:0,results:[]}))))}getCharacterById(t){return this.http.get(`${this.API_URL}/characters/${t}`).pipe(y(e=>(console.error("Personaje no encontrado",e),v(null))))}getCharactersOptions(t){return this.http.get(`${this.API_URL}/characters?page=${t.offset}`).pipe(ce(3500),P(e=>e),y(e=>(console.error("Error al obtener personajes",e),v({count:0,next:null,prev:null,pages:0,results:[]}))))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})};var K=class i{activatedRoute=u(xe);currentPage=Se(this.activatedRoute.queryParamMap.pipe(P(t=>t.get("page")?+t.get("page"):1),P(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})};var ae=()=>[],se=i=>({page:i});function Ae(i,t){if(i&1){let e=M();a(0,"button",3),g("click",function(){let l=_(e).$implicit,p=c();return b(p.activePage.set(l))}),o(1),r()}if(i&2){let e=t.$implicit,n=c();U("btn-primary",e===n.activePage()),f("routerLink",w(5,ae))("queryParams",j(6,se,e)),s(),I(" ",e," ")}}var Q=class i{pages=D(0);currentPage=D(1);activePage=_e(this.currentPage);getPagesList=fe(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(p,E)=>E+1);let n=Math.max(1,e-2),l=Math.min(t,n+4);return Array.from({length:l-n+1},(p,E)=>n+E)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-pagination"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:8,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(a(0,"section")(1,"div",0)(2,"button",1),g("click",function(){return n.previousPage()}),o(3,"\xAB"),r(),T(4,Ae,2,8,"button",2,me),a(6,"button",1),g("click",function(){return n.nextPage()}),o(7,"\xBB"),r()()()),e&2&&(s(2),f("routerLink",w(6,ae))("queryParams",j(7,se,n.activePage()-1))("disabled",n.activePage()===1),s(2),N(n.getPagesList()),s(2),f("routerLink",w(9,ae))("queryParams",j(10,se,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[H],encapsulation:2,changeDetection:0})};var W=class i{simpsonsCount=D.required();totalPages=D.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"The Simpsons"),d(),m(5,"p",4),o(6," Explora el universo de la familia m\xE1s famosa de Springfield "),d(),m(7,"div",5)(8,"div",6)(9,"div",7),B(),m(10,"svg",8),ie(11,"path",9),d()(),$(),m(12,"div",10),o(13,"Personajes"),d(),m(14,"div",11),o(15),d(),m(16,"div",12),o(17,"Total de registros"),d()(),m(18,"div",6)(19,"div",13),B(),m(20,"svg",8),ie(21,"path",14),d()(),$(),m(22,"div",10),o(23,"P\xE1ginas"),d(),m(24,"div",15),o(25),d(),m(26,"div",12),o(27,"Total disponibles"),d()()()()()()),e&2&&(s(15),I(" ",n.simpsonsCount()," "),s(10),S(n.totalPages()))},encapsulation:2,changeDetection:0})};var Ve=(i,t)=>t.label;function je(i,t){if(i&1&&(m(0,"a",1),o(1),d()),i&2){let e=c().$implicit;de("href",e.link,z),s(),S(e.label)}}function Re(i,t){if(i&1&&(m(0,"span"),o(1),d()),i&2){let e=c().$implicit;s(),S(e.label)}}function Le(i,t){if(i&1&&(m(0,"li"),x(1,je,2,2,"a",1)(2,Re,2,1,"span"),d()),i&2){let e=t.$implicit;s(),F(e.link?1:2)}}var X=class i{items=D([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"ul"),T(2,Le,3,1,"li",null,Ve),d()()),e&2&&(s(2),N(n.items()))},encapsulation:2,changeDetection:0})};var Y=class i{firestore=u(Ce);authService=u(G);favorites=h([]);loading=h(!1);addFavorite(t,e,n){let l=this.authService.currentUser();if(!l)throw new Error("Usuario no autenticado");let p={nombre:t,customName:n||t,image:e,userId:l.uid,createdAt:new Date},E=oe(this.firestore,"favorites");return A(Pe(E,ee(Z({},p),{createdAt:Ee.fromDate(p.createdAt)})))}getFavorites(){let t=this.authService.currentUser();if(!t)return A([[]]);this.loading.set(!0);let e=oe(this.firestore,"favorites"),n=we(e,Te("userId","==",t.uid));return A(ke(n)).pipe(P(l=>{let p=l.docs.map(E=>ee(Z({id:E.id},E.data()),{createdAt:E.data().createdAt.toDate()}));return this.favorites.set(p),this.loading.set(!1),p}))}updateFavorite(t,e){let n=re(this.firestore,"favorites",t);return A(De(n,{customName:e}))}deleteFavorite(t){let e=re(this.firestore,"favorites",t);return A(ye(e))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=V({token:i,factory:i.\u0275fac,providedIn:"root"})};var Be=()=>({label:"Inicio",link:"/"}),$e=()=>({label:"Simpsons",link:"/simpsons"}),Oe=()=>({label:"Personajes"}),qe=(i,t,e)=>[i,t,e],ze=i=>["/simpsons",i],Ie=(i,t)=>t.id;function Ue(i,t){if(i&1){let e=M();a(0,"div",3)(1,"select",13,0),g("change",function(){_(e);let l=pe(2),p=c();return b(p.charactersPerPage.set(+l.value))}),a(3,"option",14),o(4,"10"),r(),a(5,"option",15),o(6,"20"),r(),a(7,"option",16),o(8,"50"),r(),a(9,"option",17),o(10,"100"),r()(),C(11,"app-pagination",18)(12,"div",19),r()}if(i&2){let e=c();s(11),f("pages",e.totalPages())("currentPage",e.paginationService.currentPage())}}function He(i,t){if(i&1&&(a(0,"tr")(1,"td"),o(2),r(),a(3,"td"),o(4),r(),a(5,"td"),o(6),r(),a(7,"td")(8,"span"),o(9),r()(),a(10,"td")(11,"a",23),o(12," Ver Detalle "),r()()()),i&2){let e=t.$implicit;s(2),S(e.id),s(2),S(e.name),s(2),S(e.occupation),s(2),ue(ge("badge badge-",e.status==="Alive"?"success":"error")),s(),I(" ",e.status," "),s(2),f("routerLink",j(8,ze,e.id))}}function Ge(i,t){i&1&&(a(0,"button",21),o(1," \u2B50 En favoritos "),r())}function Je(i,t){if(i&1){let e=M();a(0,"button",24),g("click",function(){_(e);let l=c(2);return b(l.addToFavorites(l.character))}),o(1," \u2B50 Agregar "),r()}}function Ke(i,t){if(i&1&&(a(0,"div",4)(1,"table",20)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),r(),a(6,"th"),o(7,"Nombre"),r(),a(8,"th"),o(9,"Ocupaci\xF3n"),r(),a(10,"th"),o(11,"Estado"),r(),C(12,"th"),r()(),a(13,"tbody"),T(14,He,13,10,"tr",null,Ie),a(16,"td"),x(17,Ge,2,0,"button",21)(18,Je,2,0,"button",22),r()()()()),i&2){let e=c();s(14),N(e.simpsonsResource.value().results),s(3),F(e.isFavorite(e.character.character)?17:18)}}function Qe(i,t){i&1&&C(0,"span",9)}function We(i,t){i&1&&o(0," \u{1F504} Actualizar ")}function Xe(i,t){i&1&&(a(0,"div",10),C(1,"span",25),r())}function Ye(i,t){i&1&&(a(0,"div",11),B(),a(1,"svg",26),C(2,"path",27),r(),$(),a(3,"span"),o(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes!"),r()())}function Ze(i,t){i&1&&o(0," El nombre es requerido ")}function et(i,t){i&1&&o(0," M\xEDnimo 2 caracteres ")}function tt(i,t){if(i&1&&(a(0,"span",35),x(1,Ze,1,0)(2,et,1,0),r()),i&2){let e,n=c(4);s(),F((e=n.editForm.get("customName"))!=null&&e.hasError("required")?1:(e=n.editForm.get("customName"))!=null&&e.hasError("minlength")?2:-1)}}function it(i,t){if(i&1){let e=M();a(0,"form",33)(1,"input",34),g("keyup.enter",function(){_(e);let l=c(3);return b(l.saveEditedFavorite())})("keyup.escape",function(){_(e);let l=c(3);return b(l.cancelEditingFavorite())}),r(),x(2,tt,3,1,"span",35),a(3,"div",36)(4,"button",37),g("click",function(){_(e);let l=c(3);return b(l.saveEditedFavorite())}),o(5," \u2713 Guardar "),r(),a(6,"button",38),g("click",function(){_(e);let l=c(3);return b(l.cancelEditingFavorite())}),o(7," \u2715 Cancelar "),r()()()}if(i&2){let e,n,l=c(3);s(),U("input-error",((e=l.editForm.get("customName"))==null?null:e.invalid)&&((e=l.editForm.get("customName"))==null?null:e.touched)),s(),F((n=l.editForm.get("customName"))!=null&&n.invalid&&((n=l.editForm.get("customName"))!=null&&n.touched)?2:-1),s(2),f("disabled",l.editForm.invalid)}}function nt(i,t){if(i&1){let e=M();a(0,"p",39)(1,"span",40),o(2,"Nombre personalizado:"),r(),C(3,"br"),o(4),r(),a(5,"div",41)(6,"button",42),g("click",function(){_(e);let l=c().$implicit,p=c(2);return b(p.startEditingFavorite(l))}),o(7," \u270F\uFE0F Editar "),r(),a(8,"button",43),g("click",function(){_(e);let l=c().$implicit,p=c(2);return b(p.removeFromFavorites(l.id))}),o(9," \u{1F5D1}\uFE0F Eliminar "),r()()}if(i&2){let e=c().$implicit;s(4),I(" ",e.customName," ")}}function ot(i,t){if(i&1&&(a(0,"div",28)(1,"figure",29),C(2,"img",30),r(),a(3,"div",31)(4,"h3",32),o(5),r(),x(6,it,8,4,"form",33)(7,nt,10,1),r()()),i&2){let e=t.$implicit,n=c(2);s(2),f("src",e.image,z)("alt",e.nombre),s(3),S(e.nombre),s(),F(n.editingFavoriteId()===e.id?6:7)}}function rt(i,t){if(i&1&&(a(0,"div",12),T(1,ot,8,4,"div",28,Ie),r()),i&2){let e=c();s(),N(e.favorites())}}var Me=class i{simpsonsService=u(J);paginationService=u(K);favoritesService=u(Y);authService=u(G);addFavoriteAction=h(null);deleteFavoriteAction=h(null);updateFavoriteAction=h(null);charactersPerPage=h(10);totalPages=h(0);character;constructor(){te(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),this.editForm=this.fb.group({customName:["",[ne.required,ne.minLength(2)]]}),te(()=>{this.authService.currentUser()&&this.reloadFavoritesTrigger.update(e=>e+1)})}simpsonsResource=R({params:()=>({page:this.paginationService.currentPage()-1,limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});fb=u(Fe);reloadFavoritesTrigger=h(0);favoritesResource=R({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.currentUser()?this.favoritesService.getFavorites():v([])});addFavoriteResource=R({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(O(()=>{q(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),y(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),v(null)))):v(null)});deleteFavoriteResource=R({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(O(()=>{q(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),y(e=>(console.error("Error al eliminar favorito:",e),v(null)))):v(null)});updateFavoriteResource=R({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(O(()=>{q(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),y(e=>(console.error("Error al actualizar favorito:",e),v(null)))):v(null)});editingFavoriteId=h(null);editForm;favorites=()=>this.favoritesResource.value()||[];loadingFavorites=this.favoritesResource.isLoading;reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name||t.character,n=t.image||"";if(!e){console.error("Nombre del personaje no encontrado"),alert("Error: No se pudo obtener el nombre del personaje");return}this.addFavoriteAction.set({nombre:e,imagen:n})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-simpsons-page"]],decls:16,vars:15,consts:[["selectPerPage",""],[3,"items"],[3,"simpsonsCount","totalPages"],[1,"flex","gap-2","items-center","h-20","mb-4"],[1,"overflow-x-auto","mt-8"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"select","select-bordered","w-32",3,"change"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],["disabled","",1,"btn","btn-sm","btn-ghost"],[1,"btn","btn-sm","btn-primary"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"loading","loading-spinner","loading-lg"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl"],[1,"px-4","pt-4"],[1,"rounded-xl","h-48","w-full","object-cover",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],["formGroup","editForm",1,"form-control"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm",3,"keyup.enter","keyup.escape"],[1,"text-error","text-xs","mt-1"],[1,"flex","gap-2","mt-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click","disabled"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error",3,"click"]],template:function(e,n){if(e&1&&(a(0,"section"),C(1,"app-breadcrumbs",1)(2,"app-hero-simpsons",2),x(3,Ue,13,2,"div",3),x(4,Ke,19,1,"div",4),r(),a(5,"section")(6,"div",5)(7,"div",6)(8,"h2",7),o(9,"\u2B50 Mis Favoritos"),r(),a(10,"button",8),g("click",function(){return n.reloadFavorites()}),x(11,Qe,1,0,"span",9)(12,We,1,0),r()(),x(13,Xe,2,0,"div",10)(14,Ye,5,0,"div",11)(15,rt,3,0,"div",12),r()()),e&2){let l;s(),f("items",ve(11,qe,w(8,Be),w(9,$e),w(10,Oe))),s(),f("simpsonsCount",((l=n.simpsonsResource.value())==null?null:l.count)??0)("totalPages",n.totalPages()),s(),F(n.totalPages()>0?3:-1),s(),F(n.simpsonsResource.hasValue()?4:-1),s(6),f("disabled",n.loadingFavorites()),s(),F(n.loadingFavorites()?11:12),s(2),F(n.loadingFavorites()?13:n.favorites().length===0?14:15)}},dependencies:[be,H,Q,W,X],encapsulation:2,changeDetection:0})};export{Me as SimpsonsPage};
