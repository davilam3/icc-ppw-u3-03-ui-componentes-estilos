import{b as W,h as ue}from"./chunk-SSDLFJYM.js";import{a as ge}from"./chunk-KQBZW5BW.js";import{g as ce,j as z}from"./chunk-QBVPGZRV.js";import{a as ve}from"./chunk-HEH7KKZA.js";import"./chunk-TPBQQWXI.js";import{I as pe,t as de,u as M}from"./chunk-A6BW764O.js";import{k as me}from"./chunk-4FYF5LVS.js";import{$ as v,Ab as d,B as A,Bb as Q,Eb as w,Fb as ie,Hb as p,Jb as m,L as j,Nb as ne,Oa as R,Pb as B,Qb as oe,R as ee,Ra as s,Rb as o,Sb as b,Tb as D,Ub as ae,W as S,Wb as P,Xb as N,Yb as re,aa as _,ac as se,ba as V,bc as le,ca as I,eb as C,fc as y,ma as E,oa as K,p as F,pa as L,qb as f,rb as x,sb as te,t as J,tb as k,ub as T,vb as u,wb as r,xb as a,yb as h,zb as c}from"./chunk-KTUCGMTK.js";var $=class i{activatedRoute=S(ce);currentPage=de(this.activatedRoute.queryParamMap.pipe(J(t=>t.get("page")?+t.get("page"):1),J(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=ee({token:i,factory:i.\u0275fac,providedIn:"root"})};var X=()=>[],Y=i=>({page:i});function xe(i,t){if(i&1){let e=w();r(0,"button",3),p("click",function(){let l=v(e).$implicit,g=m();return _(g.activePage.set(l))}),o(1),a()}if(i&2){let e=t.$implicit,n=m();B("btn-primary",e===n.activePage()),u("routerLink",P(5,X))("queryParams",N(6,Y,e)),s(),D(" ",e," ")}}var H=class i{pages=y(0);currentPage=y(1);activePage=le(this.currentPage);getPagesList=se(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(g,O)=>O+1);let n=Math.max(1,e-2),l=Math.min(t,n+4);return Array.from({length:l-n+1},(g,O)=>n+O)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-pagination"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:8,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(r(0,"section")(1,"div",0)(2,"button",1),p("click",function(){return n.previousPage()}),o(3,"\xAB"),a(),k(4,xe,2,8,"button",2,te),r(6,"button",1),p("click",function(){return n.nextPage()}),o(7,"\xBB"),a()()()),e&2&&(s(2),u("routerLink",P(6,X))("queryParams",N(7,Y,n.activePage()-1))("disabled",n.activePage()===1),s(2),T(n.getPagesList()),s(2),u("routerLink",P(9,X))("queryParams",N(10,Y,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[z],encapsulation:2,changeDetection:0})};var G=class i{simpsonsCount=y.required();totalPages=y.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"The Simpsons"),d(),c(5,"p",4),o(6," Explora el universo de la familia m\xE1s famosa de Springfield "),d(),c(7,"div",5)(8,"div",6)(9,"div",7),V(),c(10,"svg",8),Q(11,"path",9),d()(),I(),c(12,"div",10),o(13,"Personajes"),d(),c(14,"div",11),o(15),d(),c(16,"div",12),o(17,"Total de registros"),d()(),c(18,"div",6)(19,"div",13),V(),c(20,"svg",8),Q(21,"path",14),d()(),I(),c(22,"div",10),o(23,"P\xE1ginas"),d(),c(24,"div",15),o(25),d(),c(26,"div",12),o(27,"Total disponibles"),d()()()()()()),e&2&&(s(15),D(" ",n.simpsonsCount()," "),s(10),b(n.totalPages()))},encapsulation:2,changeDetection:0})};var be=(i,t)=>t.label;function he(i,t){if(i&1&&(c(0,"a",1),o(1),d()),i&2){let e=m().$implicit;ie("href",e.link,R),s(),b(e.label)}}function Fe(i,t){if(i&1&&(c(0,"span"),o(1),d()),i&2){let e=m().$implicit;s(),b(e.label)}}function Se(i,t){if(i&1&&(c(0,"li"),f(1,he,2,2,"a",1)(2,Fe,2,1,"span"),d()),i&2){let e=t.$implicit;s(),x(e.link?1:2)}}var U=class i{items=y([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"ul"),k(2,Se,3,1,"li",null,be),d()()),e&2&&(s(2),T(n.items()))},encapsulation:2,changeDetection:0})};var Ee=()=>({label:"Inicio",link:"/"}),Ce=()=>({label:"Simpsons",link:"/simpsons"}),Pe=()=>({label:"Personajes"}),ye=(i,t,e)=>[i,t,e],ke=i=>["/simpsons",i],fe=(i,t)=>t.id;function Te(i,t){if(i&1){let e=w();r(0,"div",3)(1,"select",13,0),p("change",function(){v(e);let l=ne(2),g=m();return _(g.charactersPerPage.set(+l.value))}),r(3,"option",14),o(4,"10"),a(),r(5,"option",15),o(6,"20"),a(),r(7,"option",16),o(8,"50"),a(),r(9,"option",17),o(10,"100"),a()(),h(11,"app-pagination",18)(12,"div",19),a()}if(i&2){let e=m();s(11),u("pages",e.totalPages())("currentPage",e.paginationService.currentPage())}}function we(i,t){i&1&&(r(0,"button",22),o(1," \u2B50 En favoritos "),a())}function De(i,t){if(i&1){let e=w();r(0,"button",24),p("click",function(){v(e);let l=m().$implicit,g=m(2);return _(g.addToFavorites(l))}),o(1," \u2B50 Agregar "),a()}}function Ne(i,t){if(i&1&&(r(0,"tr")(1,"td"),o(2),a(),r(3,"td"),o(4),a(),r(5,"td"),o(6),a(),r(7,"td")(8,"span"),o(9),a()(),r(10,"td")(11,"a",21),o(12," Ver Detalle "),a()(),r(13,"td"),f(14,we,2,0,"button",22)(15,De,2,0,"button",23),a()()),i&2){let e=t.$implicit,n=m(2);s(2),b(e.id),s(2),b(e.name),s(2),b(e.occupation),s(2),oe(ae("badge badge-",e.status==="Alive"?"success":"error")),s(),D(" ",e.status," "),s(2),u("routerLink",N(9,ke,e.id)),s(3),x(n.isFavorite(e.name)?14:15)}}function Me(i,t){if(i&1&&(r(0,"div",4)(1,"table",20)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),a(),r(6,"th"),o(7,"Nombre"),a(),r(8,"th"),o(9,"Ocupaci\xF3n"),a(),r(10,"th"),o(11,"Estado"),a(),h(12,"th"),a()(),r(13,"tbody"),k(14,Ne,16,11,"tr",null,fe),a()()()),i&2){let e=m();s(14),T(e.simpsonsResource.value().results)}}function Ve(i,t){i&1&&h(0,"span",9)}function Ie(i,t){i&1&&o(0," \u{1F504} Actualizar ")}function Ae(i,t){i&1&&(r(0,"div",10),h(1,"span",25),a())}function je(i,t){i&1&&(r(0,"div",11),V(),r(1,"svg",26),h(2,"path",27),a(),I(),r(3,"span"),o(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes!"),a()())}function Le(i,t){i&1&&o(0," El nombre es requerido ")}function Re(i,t){i&1&&o(0," M\xEDnimo 2 caracteres ")}function Be(i,t){if(i&1&&(r(0,"span",35),f(1,Le,1,0)(2,Re,1,0),a()),i&2){let e,n=m(4);s(),x((e=n.editForm.get("customName"))!=null&&e.hasError("required")?1:(e=n.editForm.get("customName"))!=null&&e.hasError("minlength")?2:-1)}}function ze(i,t){if(i&1){let e=w();r(0,"form",33)(1,"input",34),p("keyup.enter",function(){v(e);let l=m(3);return _(l.saveEditedFavorite())})("keyup.escape",function(){v(e);let l=m(3);return _(l.cancelEditingFavorite())}),a(),f(2,Be,3,1,"span",35),r(3,"div",36)(4,"button",37),p("click",function(){v(e);let l=m(3);return _(l.saveEditedFavorite())}),o(5," \u2713 Guardar "),a(),r(6,"button",38),p("click",function(){v(e);let l=m(3);return _(l.cancelEditingFavorite())}),o(7," \u2715 Cancelar "),a()()()}if(i&2){let e,n,l=m(3);s(),B("input-error",((e=l.editForm.get("customName"))==null?null:e.invalid)&&((e=l.editForm.get("customName"))==null?null:e.touched)),s(),x((n=l.editForm.get("customName"))!=null&&n.invalid&&((n=l.editForm.get("customName"))!=null&&n.touched)?2:-1),s(2),u("disabled",l.editForm.invalid)}}function $e(i,t){if(i&1){let e=w();r(0,"p",39)(1,"span",40),o(2,"Nombre personalizado:"),a(),h(3,"br"),o(4),a(),r(5,"div",41)(6,"button",42),p("click",function(){v(e);let l=m().$implicit,g=m(2);return _(g.startEditingFavorite(l))}),o(7," \u270F\uFE0F Editar "),a(),r(8,"button",43),p("click",function(){v(e);let l=m().$implicit,g=m(2);return _(g.removeFromFavorites(l.id))}),o(9," \u{1F5D1}\uFE0F Eliminar "),a()()}if(i&2){let e=m().$implicit;s(4),D(" ",e.customName," ")}}function qe(i,t){if(i&1&&(r(0,"div",28)(1,"figure",29),h(2,"img",30),a(),r(3,"div",31)(4,"h3",32),o(5),a(),f(6,ze,8,4,"form",33)(7,$e,10,1),a()()),i&2){let e=t.$implicit,n=m(2);s(2),u("src",e.image,R)("alt",e.nombre),s(3),b(e.nombre),s(),x(n.editingFavoriteId()===e.id?6:7)}}function He(i,t){if(i&1&&(r(0,"div",12),k(1,qe,8,4,"div",28,fe),a()),i&2){let e=m();s(),T(e.favorites())}}var _e=class i{simpsonsService=S(ge);paginationService=S($);favoritesService=S(ve);authService=S(pe);addFavoriteAction=E(null);deleteFavoriteAction=E(null);updateFavoriteAction=E(null);charactersPerPage=E(10);totalPages=E(0);character;constructor(){K(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),this.editForm=this.fb.group({customName:["",[W.required,W.minLength(2)]]}),K(()=>{this.authService.currentUser()&&this.reloadFavoritesTrigger.update(e=>e+1)})}simpsonsResource=M({params:()=>({page:this.paginationService.currentPage()-1,limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});fb=S(ue);reloadFavoritesTrigger=E(0);favoritesResource=M({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.currentUser()?this.favoritesService.getFavorites():F([])});addFavoriteResource=M({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(j(()=>{L(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),A(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),F(null)))):F(null)});deleteFavoriteResource=M({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(j(()=>{L(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),A(e=>(console.error("Error al eliminar favorito:",e),F(null)))):F(null)});updateFavoriteResource=M({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(j(()=>{L(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),A(e=>(console.error("Error al actualizar favorito:",e),F(null)))):F(null)});editingFavoriteId=E(null);editForm;favorites=()=>this.favoritesResource.value()||[];loadingFavorites=this.favoritesResource.isLoading;reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name,n=`https://cdn.thesimpsonsapi.com/500${t.portrait_path}`;if(!e){console.error("Nombre del personaje no encontrado"),alert("Error: No se pudo obtener el nombre del personaje");return}this.addFavoriteAction.set({nombre:e,imagen:n})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-simpsons-page"]],decls:16,vars:15,consts:[["selectPerPage",""],[3,"items"],[3,"simpsonsCount","totalPages"],[1,"flex","gap-2","items-center","h-20","mb-4"],[1,"overflow-x-auto","mt-8"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"select","select-bordered","w-32",3,"change"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["disabled","",1,"btn","btn-sm","btn-ghost"],[1,"btn","btn-sm","btn-primary"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"loading","loading-spinner","loading-lg"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl"],[1,"px-4","pt-4"],[1,"rounded-xl","h-48","w-full","object-cover",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],["formGroup","editForm",1,"form-control"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm",3,"keyup.enter","keyup.escape"],[1,"text-error","text-xs","mt-1"],[1,"flex","gap-2","mt-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click","disabled"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error",3,"click"]],template:function(e,n){if(e&1&&(r(0,"section"),h(1,"app-breadcrumbs",1)(2,"app-hero-simpsons",2),f(3,Te,13,2,"div",3),f(4,Me,16,0,"div",4),a(),r(5,"section")(6,"div",5)(7,"div",6)(8,"h2",7),o(9,"\u2B50 Mis Favoritos"),a(),r(10,"button",8),p("click",function(){return n.reloadFavorites()}),f(11,Ve,1,0,"span",9)(12,Ie,1,0),a()(),f(13,Ae,2,0,"div",10)(14,je,5,0,"div",11)(15,He,3,0,"div",12),a()()),e&2){let l;s(),u("items",re(11,ye,P(8,Ee),P(9,Ce),P(10,Pe))),s(),u("simpsonsCount",((l=n.simpsonsResource.value())==null?null:l.count)??0)("totalPages",n.totalPages()),s(),x(n.totalPages()>0?3:-1),s(),x(n.simpsonsResource.hasValue()?4:-1),s(6),u("disabled",n.loadingFavorites()),s(),x(n.loadingFavorites()?11:12),s(2),x(n.loadingFavorites()?13:n.favorites().length===0?14:15)}},dependencies:[me,z,H,G,U],encapsulation:2,changeDetection:0})};export{_e as SimpsonsPage};
